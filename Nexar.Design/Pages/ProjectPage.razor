@page "/project"
@inherits AbstractPage

@if (ProjectItem.Current is not null)
{
    <ItemPageHeader Text="Project" Item=@ProjectItem.Current />

    <TextFieldCopy Label="Id" Text=@ProjectItem.Current.Tag.Id />

    <TextFieldUrl Label="Url" Href=@ProjectItem.Current.Tag.Url />

    <TextField Label="Name" Text=@ProjectItem.Current.Tag.Name />

    <TextField Label="LatestRevision (CreatedAt / Author / Message / RevisionId)" Text=@Revision(ProjectItem.Current) />

    <FieldImage Label="Preview" Src=@ProjectItem.Current.Tag.PreviewUrl />

    <MudTable Items=@ProjectItem.Current.Tag.Parameters>
        <ToolBarContent>
            <MudText Typo=Typo.h6>Parameters</MudText>
        </ToolBarContent>
        <HeaderContent>
            <MudTh>Name</MudTh>
            <MudTh>Value</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Value">@context.Value</MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    protected override void OnInitialized()
    {
        ProjectItem.OnChange += StateHasChanged;
    }

    protected override void Disposing()
    {
        ProjectItem.OnChange -= StateHasChanged;
    }

    string Revision(ProjectItem item)
    {
        var rev = item.Tag.LatestRevision;
        return $"{rev.CreatedAt.ToString("yyyy-MM-dd")} / {rev.Author} / {rev.Message} / {rev.RevisionId}";
    }
}
