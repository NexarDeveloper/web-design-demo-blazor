@page "/task"
@inherits AbstractPage

@if (TaskItem.Current is not null)
{
    <ItemPageHeader Text="Task" Item=@TaskItem.Current />

    <TextFieldCopy Label="Id" Text=@TaskItem.Current.Tag.Id />

    <TextField Label="Name" Text=@TaskItem.Current.Tag.Name />

    <TextField Label="RefId" Text=@TaskItem.Current.Tag.RefId />

    <TextField Label="Priority" Text=@TaskItem.Current.Tag.Priority.ToString() />

    <TextField Label="Status" Text=@TaskItem.Current.Tag.Status.ToString() />

    <TextFieldText Label="Description" Text=@TaskItem.Current.Tag.Description />

    <TextField Label="Assignee (UserId / Email)" Text=@(TaskItem.Current.Tag.Assignee.UserId + " / " + TaskItem.Current.Tag.Assignee.Email) />

    <TextField Label="CreatedBy (UserId / Email)" Text=@(TaskItem.Current.Tag.CreatedBy.UserId + " / " + TaskItem.Current.Tag.CreatedBy.Email) />

    <TextField Label="CreatedAt" Text=@TaskItem.Current.Tag.CreatedAt.ToString() />

    <TextField Label="ModifiedAt" Text="@TaskItem.Current.Tag.ModifiedAt.ToString()" />

    @if (TaskItem.Current.Comments is null)
    {
        <MudProgressCircular Indeterminate=true />
    }
    else if (TaskItem.Current.Comments.Count > 0)
    {
        <MudText Typo=Typo.h5>Comments</MudText>

        foreach (var comment in TaskItem.Current.Comments)
        {
            <CardComment Text=@comment.Text>
                <Head>
                    <TextKeyValue Key="CreatedBy" Value=@(comment.CreatedBy.UserId + " / " + comment.CreatedBy.Email) />
                    <TextKeyValue Key="CommentId" Value=@comment.CommentId />
                </Head>
            </CardComment>
        }
    }
}

@code {
    protected override void OnInitialized()
    {
        TaskItem.OnChange += StateHasChanged;
    }

    protected override void Disposing()
    {
        TaskItem.OnChange -= StateHasChanged;
    }
}
