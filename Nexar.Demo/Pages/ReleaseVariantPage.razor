@page "/ReleaseVariant"
@inherits AbstractPage
@using Data = ReleaseVariantItem

@if (Data.Current is null)
    return;

<ItemPageHeader Text="Release Variant" Item=@Data.Current />

<TextField Label="Name" Text=@Data.Current.Tag.Name />
<TextFieldUrl Label="DownloadUrl" Href=@Data.Current.Tag.DownloadUrl Text="Full Release" />

@if (Data.Current.Tag.PcbAssembly is { })
{
    <br />
    <MudText Typo=Typo.h6>PcbAssembly</MudText>
    <TextField Label="Version" Text=@Data.Current.Tag.PcbAssembly.Version />
    <TextField Label="LifeCycleStateName" Text=@Data.Current.Tag.PcbAssembly.LifeCycleStateName />
    <TextFieldUrl Label="Download" Href=@Data.Current.Tag.PcbAssembly.DownloadUrl Text=@Data.Current.Tag.PcbAssembly.PackageName />
    <MudField Label="Folders/Files" Variant=Variant.Outlined>
        <MudList T="string" Dense=true ReadOnly=true>
            @foreach (var folder in Data.Current.Tag.PcbAssembly.Folders)
            {
                <MudListItem>
                    <MudLink Href=@folder.DownloadUrl Target=_blank>@folder.RelativePath</MudLink>
                </MudListItem>
                @foreach (var file in folder.Files)
                {
                    <MudListItem Icon=@Icons.Material.Filled.Check>
                        <MudLink Href=@file.DownloadUrl Target=_blank>@file.FileName</MudLink>
                    </MudListItem>
                }
            }
        </MudList>
    </MudField>
}

@if (Data.Current.Tag.PcbFabrication is { })
{
    <br />
    <MudText Typo=Typo.h6>PcbFabrication</MudText>
    <TextField Label="Version" Text=@Data.Current.Tag.PcbFabrication.Version />
    <TextField Label="LifeCycleStateName" Text=@Data.Current.Tag.PcbFabrication.LifeCycleStateName />
    <TextFieldUrl Label="Download" Href=@Data.Current.Tag.PcbFabrication.DownloadUrl Text=@Data.Current.Tag.PcbFabrication.PackageName />
    <MudField Label="Folders/Files" Variant=Variant.Outlined>
        <MudList T="string" Dense=true ReadOnly=true>
            @foreach (var folder in Data.Current.Tag.PcbFabrication.Folders)
            {
                <MudListItem>
                    <MudLink Href=@folder.DownloadUrl Target=_blank>@folder.RelativePath</MudLink>
                </MudListItem>
                @foreach (var file in folder.Files)
                {
                    <MudListItem Icon=@Icons.Material.Filled.Check>
                        <MudLink Href=@file.DownloadUrl Target=_blank>@file.FileName</MudLink>
                    </MudListItem>
                }
            }
        </MudList>
    </MudField>
}

<br />
<AlertGraphQL Files="Project.Releases.graphql Project.ReleaseById.graphql" />

@code {
    protected override void OnInitialized()
    {
        Data.OnChange += StateHasChanged;
    }

    protected override void Disposing()
    {
        Data.OnChange -= StateHasChanged;
    }
}
