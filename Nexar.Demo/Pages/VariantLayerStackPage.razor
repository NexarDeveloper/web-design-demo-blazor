@page "/VariantLayerStack"
@inherits AbstractPage
@using Nexar.Client

@if (VariantLayerStackItem.Current?.Tag is not null)
{
    <ItemPageHeader Text="Layer Stack" Item=@VariantLayerStackItem.Current />

    <TextField Label="StackupType" Text=@VariantLayerStackItem.Current.Tag.StackupType />

    <TextField Label="RoughnessType" Text=@VariantLayerStackItem.Current.Tag.RoughnessType />

    <TextField Label="RoughnessFactorSR" Text=@VariantLayerStackItem.Current.Tag.RoughnessFactorSR />

    <TextField Label="RoughnessFactorRF" Text=@VariantLayerStackItem.Current.Tag.RoughnessFactorRF />

    @foreach (var stack in Stacks)
    {
        <br />
        <MudTable Items=@stack.Layers Dense=true>
            <ToolBarContent>
                <MudText Typo=Typo.h6>@(stack.Name ?? "Layers")</MudText>
                </ToolBarContent>
                <HeaderContent>
                    <MudTh>Name</MudTh>
                    <MudTh>LayerType</MudTh>
                    <MudTh>Material</MudTh>
                    <MudTh>Thickness</MudTh>
                    <MudTh>CopperRatio</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Name">@context.Name</MudTd>
                    <MudTd DataLabel="LayerType">@context.LayerType</MudTd>
                    <MudTd DataLabel="Material">@context.Material</MudTd>
                    <MudTd DataLabel="Thickness">@context.Thickness?.X</MudTd>
                    <MudTd DataLabel="CopperRatio">@context.CopperRatio</MudTd>
                </RowTemplate>
            </MudTable>
    }

    <br />
    <AlertGraphQL Files="Project.Variants.graphql Variant.LayerStack.graphql" />
}
else
{
    <MudProgressCircular Indeterminate=true />
}

@code {
    protected override void OnInitialized()
    {
        VariantLayerStackItem.OnChange += StateHasChanged;
    }

    protected override void Disposing()
    {
        VariantLayerStackItem.OnChange -= StateHasChanged;
    }

    IEnumerable<IMyStack> Stacks => VariantLayerStackItem.Current.Tag.Stacks.Cast<IMyStack>();
}
